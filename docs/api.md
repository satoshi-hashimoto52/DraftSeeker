# API

Swagger の定義そのものではなく、**使いどころベース**で整理しています。

## GET /templates

役割:
- プロジェクトごとのクラス一覧とテンプレ数を取得

UI対応:
- プロジェクト選択やクラス内訳表示の初期ロード

処理負荷:
- 軽い（ファイル一覧のスキャン結果を返す）

タイミング:
- 画面初期表示時

## GET /projects

役割:
- プロジェクト一覧の取得

UI対応:
- プロジェクト選択プルダウンの生成

処理負荷:
- 軽い

タイミング:
- 画面初期表示時

## POST /image/upload

役割:
- 画像アップロードと `image_id` 発行

UI対応:
- 画像を読み込んだタイミング

処理負荷:
- 中（画像保存・サイズ取得）

タイミング:
- 画像アップロード時

## POST /detect/point

役割:
- クリック点周辺ROIのテンプレ照合 → フィルタ → NMS → クラス代表 → TopK
- Template OFF時は輪郭抽出で候補生成

UI対応:
- クリック検出、候補リスト更新、bbox表示

処理負荷:
- 中（テンプレ数とスケール数に依存）

タイミング:
- 画像クリック時

## POST /detect/full

役割:
- 画像全体をタイル（1024x1024）でテンプレ照合し候補生成

UI対応:
- 一括検出（現状 UI 未対応）

処理負荷:
- 重い（タイル数とテンプレ数に依存）

タイミング:
- バッチ検出や検証用途

## POST /segment/candidate

役割:
- 選択候補のROIに対して SAM でセグメント生成
- 失敗時はフォールバックで輪郭抽出

UI対応:
- 「Seg生成（SAM）」ボタン

処理負荷:
- 重い（SAM推論）

タイミング:
- 必要時のみ（オンデマンド）

## POST /export/yolo

役割:
- annotation を YOLO / YOLO-seg 形式で 1画像=1txt 出力
- `data/runs/<project>/classes.json` に class_id を保存

UI対応:
- 「YOLOエクスポート」ボタン

処理負荷:
- 軽い

タイミング:
- アノテ確定後の出力時
